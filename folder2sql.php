<?php

///MySQL DB name 
$db_name = "peanalysis";
///MySQL DB user 
$db_user = "peanalysis";
///MySQL DB password
$db_password = "peanalys";
///MySQL server address
$db_host = "localhost";

//Make MySQL Conntection
if (mysql_connect($db_host, $db_user, $db_password) === FALSE)
    $this->output.="Cannot Create Connection to DB<br>";
if (mysql_select_db($db_name) === FALSE)
    $this->output.="Cannot Select the Table into DB<br>";

//Path to the storage with files (names as md5) 
$dir = 'windows/PE/'; 
$allFiles = scandir($dir); //Remove two folders
$files = array_diff($allFiles, array('.', '..')); 

//Fo through each file in a directory
printf(sizeof($files));

$i=0;
//Form query
$query = "INSERT INTO `rawData`
	(`md5`)
	VALUES " ;
$query_insert="";
$query_duplicate="";
foreach ($files as $file) {
   //name of the file (md5 sum)
   $md5 =   $file;
   //md5 in hexadecimal to binary
   $query_insert.=" (UNHEX('" . $md5 ."')),";
   $query_duplicate="`md5`= rawData.md5";
   $i++;
}
//cut last commas
$query_insert = rtrim($query_insert, ',');
//$query_duplicate = rtrim($query_duplicate, ',');
$query.=$query_insert." ON DUPLICATE KEY  UPDATE ".$query_duplicate.";";
//echo $query;
//Check whether it is possible to execute query
if (mysql_query($query) === FALSE)
	echo "\n Impossible to execute INSERT/UPDATE query! " ;
?>
